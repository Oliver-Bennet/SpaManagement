{% extends "layout/base.html" %}
{% block title %}Trang ch·ªß K·ªπ thu·∫≠t vi√™n{% endblock %}

{% block content %}
<div class="container py-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h6 class="text-muted mb-3">üìÖ Ch·ªçn ng√†y xem l·ªãch:</h6>
            <div class="d-flex flex-wrap gap-2">
                {% for d in days %}
                <a href="/technician?date={{ d.strftime('%Y-%m-%d') }}"
                   class="btn btn-sm
                       {% if d == selected_date %}
                           btn-primary fw-bold shadow
                       {% else %}
                           btn-outline-secondary border-0
                       {% endif %}">

                    <div style="font-size: 0.8rem;">
                        {{ d.strftime('T%w') if d.weekday() != 6 else 'CN' }}
                    </div>
                    <div style="font-size: 1.2rem; font-weight: bold;">
                        {{ d.day }}/{{ d.month }}
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="text-center mb-4">
        <h2 class="text-success fw-bold">
            Ch√†o {{ current_user.full_name }}!
        </h2>
        <p class="lead text-muted">
            L·ªãch ng√†y <span class="text-dark fw-bold">{{ selected_date.strftime("%d/%m/%Y") }}</span>:
            <strong class="text-primary">{{ today_appointments|length }} kh√°ch</strong>
        </p>
    </div>

    <div class="row">
        {% for appt in today_appointments %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card shadow-sm h-100 border-0">
                <div class="card-header text-white {{ 'bg-secondary' if appt.status == 'DONE' else 'bg-success' }}">
                    <strong>‚è∞ {{ appt.start_time }} - {{ appt.end_time }}</strong>
                </div>

                <div class="card-body">
                    <h5 class="card-title">{{ appt.customer.full_name }}</h5>
                    <p class="card-text text-muted mb-1">
                        <i class="fa-solid fa-spa"></i> {{ appt.service.name or appt.package.name }}
                    </p>

                    {% if appt.status == 'DONE' %}
                        <span class="badge bg-secondary mb-3">‚úî ƒê√£ ho√†n th√†nh</span>
                    {% else %}
                        <span class="badge bg-warning text-dark mb-3">‚è≥ ƒêang ch·ªù</span>
                    {% endif %}

                    {% if appt.status != 'DONE' %}
                        <a href="/technician/record/{{ appt.id }}"
                           class="btn btn-outline-success w-100 mt-2">
                            üìù Ghi nh·∫≠n ti·∫øn tr√¨nh
                        </a>
                    {% else %}
                        <button class="btn btn-light w-100 mt-2" disabled>
                            Xem l·∫°i h·ªì s∆°
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12 text-center py-5">
            <img src="https://cdn-icons-png.flaticon.com/512/7486/7486744.png" width="100" class="mb-3 opacity-50">
            <h4 class="text-muted">Ng√†y n√†y b·∫°n kh√¥ng c√≥ l·ªãch n√†o ‚ú®</h4>
            <p>H√£y ch·ªçn ng√†y kh√°c ·ªü tr√™n ƒë·ªÉ ki·ªÉm tra.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}